<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é£²æ–™äººæ ¼æ¸¬é©— - æ¸¬é©—ä¸­</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{ --bg: linear-gradient(160deg,#F7E6DC 0%, #EAE0D7 100%); }
    body{
      font-family:'Noto Sans TC',-apple-system,BlinkMacSystemFont,sans-serif;
      color:#6B5D54; min-height:100vh; padding:20px;
      background: var(--bg); transition: background 600ms ease;
    }
    .quiz-container{max-width:640px;margin:0 auto;background:#fff;border-radius:20px;padding:40px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .progress-bar{width:100%;height:8px;background:#E8D5C4;border-radius:4px;margin-bottom:30px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(135deg,#FFB4AE 0%,#F4A6A0 100%);border-radius:4px;transition:width .3s}
    .question-number{font-size:14px;color:#9B8D84;margin-bottom:10px}
    .question{font-size:24px;font-weight:700;color:#6B5D54;margin-bottom:24px;line-height:1.4}
    .options{display:flex;flex-direction:column;gap:14px}
    .option{padding:18px 16px;background:#F8F5F2;border:2px solid transparent;border-radius:14px;cursor:pointer;transition:all .25s;font-size:16px;color:#6B5D54}
    .option:hover{background:#F4A6A0;color:#fff;transform:translateY(-2px);box-shadow:0 5px 15px rgba(244,166,160,.25)}
    .option.selected{background:#F4A6A0;color:#fff;border-color:#E8A6A0}
    @media (max-width:520px){.quiz-container{padding:20px}.question{font-size:20px}}
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="question-number" id="questionNumber">å•é¡Œ 1 / 5</div>
    <div class="question" id="questionText">ä½ å–œæ­¡ä»€éº¼æ¨£çš„ç¤¾äº¤å ´åˆï¼Ÿ</div>
    <div class="options" id="optionsContainer"></div>
  </div>

  <script src="./config.js"></script>
  <script src="./tracker.js"></script>
  <script>
    // æ¯é¡Œæ¼¸å±¤èƒŒæ™¯
    const BG_GRADS = [
      'linear-gradient(160deg,#F7E6DC 0%, #EAE0D7 100%)',
      'linear-gradient(160deg,#FDE2DF 0%, #F5E6E3 100%)',
      'linear-gradient(160deg,#EAF2E9 0%, #E7EFEF 100%)',
      'linear-gradient(160deg,#E8E6F8 0%, #ECE7F2 100%)',
      'linear-gradient(160deg,#FFF1DB 0%, #F7E8D6 100%)',
      'linear-gradient(160deg,#EFE6FF 0%, #EDE9F9 100%)'
    ];
    const setBg = (i)=> document.body.style.background = BG_GRADS[i % BG_GRADS.length];

    // é¡Œåº«
    const questions = [
      { question:"ä½ å–œæ­¡ä»€éº¼æ¨£çš„ç¤¾äº¤å ´åˆï¼Ÿ",
        options:[
          { text:"å¤§å‹æ´¾å°ï¼Œèªè­˜æ–°æœ‹å‹", score:{ extrovert:2, social:2 } },
          { text:"å°åœ˜é«”èšæœƒï¼Œæ·±åº¦äº¤æµ", score:{ introvert:2, thoughtful:2 } },
          { text:"å®‰éœçš„å’–å•¡å»³ï¼Œä¸€å°ä¸€èŠå¤©", score:{ introvert:1, calm:2 } },
          { text:"æˆ¶å¤–æ´»å‹•ï¼Œå¤§å®¶ä¸€èµ·ç©", score:{ extrovert:1, active:2 } }
        ]
      },
      { question:"ç•¶ä½ æ„Ÿåˆ°å£“åŠ›æ™‚ï¼Œä½ æœƒï¼Ÿ",
        options:[
          { text:"æ‰¾æœ‹å‹èŠå¤©ï¼Œå°‹æ±‚æ”¯æŒ", score:{ social:2, extrovert:1 } },
          { text:"ç¨è‡ªæ€è€ƒï¼Œåˆ†æå•é¡Œ", score:{ introvert:2, analytical:2 } },
          { text:"é‹å‹•æˆ–åšå…¶ä»–æ´»å‹•è½‰ç§»æ³¨æ„åŠ›", score:{ active:2, practical:1 } },
          { text:"è½éŸ³æ¨‚æˆ–çœ‹æ›¸æ”¾é¬†", score:{ calm:2, introvert:1 } }
        ]
      },
      { question:"ä½ ç†æƒ³çš„å·¥ä½œç’°å¢ƒæ˜¯ï¼Ÿ",
        options:[
          { text:"é–‹æ”¾å¼è¾¦å…¬å®¤ï¼Œåœ˜éšŠåˆä½œ", score:{ social:2, collaborative:2 } },
          { text:"ç¨ç«‹è¾¦å…¬å®¤ï¼Œå°ˆæ³¨å·¥ä½œ", score:{ introvert:2, focused:2 } },
          { text:"éˆæ´»çš„å·¥ä½œç©ºé–“ï¼Œå¯ä»¥ç§»å‹•", score:{ active:2, flexible:2 } },
          { text:"å®‰éœçš„åœ–æ›¸é¤¨æˆ–å’–å•¡å»³", score:{ calm:2, introvert:1 } }
        ]
      },
      { question:"ä½ å¦‚ä½•åšæ±ºå®šï¼Ÿ",
        options:[
          { text:"å¿«é€Ÿæ±ºå®šï¼Œç›¸ä¿¡ç›´è¦º", score:{ spontaneous:2, confident:1 } },
          { text:"ä»”ç´°åˆ†ææ‰€æœ‰é¸é …", score:{ analytical:2, thoughtful:2 } },
          { text:"è©¢å•ä»–äººæ„è¦‹", score:{ social:2, collaborative:1 } },
          { text:"è€ƒæ…®é•·æœŸå½±éŸ¿", score:{ thoughtful:2, strategic:2 } }
        ]
      },
      { question:"ä½ å–œæ­¡ä»€éº¼æ¨£çš„é£²æ–™ï¼Ÿ",
        options:[
          { text:"æ¿ƒéƒçš„å’–å•¡ï¼Œæç¥é†’è…¦", score:{ energetic:2, focused:1 } },
          { text:"æº«å’Œçš„èŒ¶ï¼Œå¹³éœå¿ƒæƒ…", score:{ calm:2, thoughtful:1 } },
          { text:"æ¸…çˆ½çš„æœæ±ï¼Œæ´»åŠ›æ»¿æ»¿", score:{ active:2, energetic:1 } },
          { text:"é¦™ç”œçš„å¥¶èŒ¶ï¼Œæº«æš–èˆ’é©", score:{ social:1, comfortable:2 } }
        ]
      }
    ];

    const PROFILE_META = {
      "çç å¥¶èŒ¶":{ emoji:"ğŸ§‹", tags:["å¯æ„›è¦ªå’Œ","ç¤¾äº¤é«˜æ‰‹"],
        desc:"ä½ å°±åƒçç å¥¶èŒ¶ä¸€æ¨£ï¼Œå¤–è¡¨ç”œç¾å¯æ„›ï¼Œå…§å¿ƒè±å¯Œå¤šå½©ã€‚ä½ å–„æ–¼ç¤¾äº¤ï¼Œå–œæ­¡èˆ‡äººäº’å‹•ï¼Œç¸½æ˜¯èƒ½å¸¶çµ¦èº«é‚Šçš„äººå¿«æ¨‚å’Œæº«æš–ã€‚" },
      "ç¾å¼å’–å•¡":{ emoji:"â˜•", tags:["ç›´æ¥ç´”ç²¹","æ•ˆç‡è‡³ä¸Š"],
        desc:"ä½ å°±åƒç¾å¼å’–å•¡ä¸€æ¨£ï¼Œç›´æ¥è€Œç´”ç²¹ã€‚ä½ å–œæ­¡ç°¡å–®ç›´æ¥çš„ç”Ÿæ´»æ–¹å¼ï¼Œåšäº‹æ•ˆç‡é«˜ï¼Œæœ‰è‡ªå·±çš„åŸå‰‡å’Œå …æŒã€‚" },
      "ç¶ èŒ¶":{ emoji:"ğŸµ", tags:["æ¸…æ–°æ²‰ç©©","ç†æ€§åˆ†æ"],
        desc:"ä½ å°±åƒç¶ èŒ¶ä¸€æ¨£ï¼Œæ¸…æ–°æ·¡é›…ï¼Œå…§å¿ƒå¹³éœã€‚ä½ å–œæ­¡æ€è€ƒã€å–„æ–¼åˆ†æï¼Œæ˜¯ä¸€ä½å¯é çš„å‚¾è½è€…èˆ‡å»ºè­°è€…ã€‚" },
      "æœæ±":{ emoji:"ğŸ§ƒ", tags:["æ´»åŠ›æ»¿æ»¿","æ¨‚æ–¼å˜—æ–°"],
        desc:"ä½ å°±åƒæœæ±ä¸€æ¨£ï¼Œå……æ»¿æ´»åŠ›èˆ‡æ­£èƒ½é‡ã€‚ä½ æ¨‚è§€é–‹æœ—ï¼Œå–œæ­¡å˜—è©¦æ–°äº‹ç‰©ï¼Œç¸½èƒ½å¸¶å‹•å‘¨åœçš„æ°£æ°›ã€‚" }
    };

    // ç‹€æ…‹
    let idx = 0, scores = {}, quizStart = Date.now();
    const AUTO_NEXT_MS = 400;
    const $ = s => document.querySelector(s);

    window.addEventListener('DOMContentLoaded', ()=>{
      window.Tracker?.init?.();
      window.Tracker?.track?.('page_view',{ page:'quiz', title:'é£²æ–™äººæ ¼æ¸¬é©—' });
      render();
    });

    function render(){
      const q = questions[idx];
      setBg(idx);
      $('#questionNumber').textContent = `å•é¡Œ ${idx+1} / ${questions.length}`;
      $('#questionText').textContent = q.question;
      $('#progressFill').style.width = (idx/questions.length)*100 + '%';

      const box = $('#optionsContainer');
      box.innerHTML = '';
      q.options.forEach((op,i)=>{
        const el = document.createElement('div');
        el.className='option';
        el.textContent=op.text;
        el.onclick = ()=>onPick(i, el);
        box.appendChild(el);
      });
    }

    function onPick(i, el){
      document.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
      el.classList.add('selected');
      window.Tracker?.track?.('option_select',{ question: idx+1, option:i, text:questions[idx].options[i].text });

      // è¨˜åˆ†
      const picked = questions[idx].options[i];
      Object.keys(picked.score).forEach(k => { scores[k] = (scores[k]||0) + picked.score[k]; });

      // è‡ªå‹•ä¸‹ä¸€é¡Œ/çµæŸ
      setTimeout(()=>{
        idx++;
        if(idx < questions.length){ render(); }
        else{ finish(); }
      }, AUTO_NEXT_MS);
    }

    function calcResultName(){
      if((scores.social||0)>3) return 'çç å¥¶èŒ¶';
      if((scores.analytical||0)>3) return 'ç¾å¼å’–å•¡';
      if((scores.calm||0)>3) return 'ç¶ èŒ¶';
      return 'æœæ±';
    }

    function finish(){
      const name = calcResultName();
      const meta = PROFILE_META[name];
      const spent = Date.now() - quizStart;

      // å­˜åˆ° localStorage çµ¦ result.html ä½¿ç”¨ï¼ˆæŒä¹…åŒ–å­˜å„²ï¼‰
      localStorage.setItem('quiz_result', JSON.stringify({
        name, meta, scores, spent
      }));

      // âœ… ä¿å­˜æ¸¬é©—çµæœåˆ°å¾Œç«¯æ•¸æ“šåº«
      window.Tracker?.saveResult?.(name, scores);

      window.Tracker?.track?.('quiz_complete',{ result:name, time_spent:spent, scores });

      // è·³åˆ°ç¨ç«‹çµæœé ï¼ˆå¸¶åƒæ•¸ï¼‰
      const resultUrl = new URL('./result.html', window.location.href);
      resultUrl.searchParams.set('r', encodeURIComponent(name));
      resultUrl.searchParams.set('scores', encodeURIComponent(JSON.stringify(scores)));
      location.href = resultUrl.toString();
    }
  </script>
</body>
</html>
